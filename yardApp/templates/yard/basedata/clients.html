<script>
    Namespace.register('basedata.clientsview');
    $(function () {
        basedata.clientsview.datagrid = $('#basedata-client-datagrid').datagrid({
            border: false,
            columns: [
                [
                    {field: 'insert_flag', hidden: true},
                    {field: 'id', hidden: true},
                    {field: 'client_name',
                        title: '客户名称',
                        align:'center',
                        width: 100,
                        editor: {
                            type: 'validatebox',
                            options: {
                                required: true
                            }
                        }
                    },
                    {field: 'client_flag',
                        title: '客户标识',
                        align:'center',
                        editor: {
                            type: 'checkbox',
                            options: {
                                on: 'true',
                                off: 'false'
                            }
                        },
                        formatter: function (value, rowData, rowIndex) {
                            //console.info(typeof(value))
                            //console.info(value);
                            if (value != null && value.toString() == 'true') {
                                return '<input type="checkbox" disabled="true" checked="checked" />';
                            } else {
                                return '<input type="checkbox" disabled="true" />';
                            }
                        }
                    },
                    {field: 'custom_flag',
                        title: '报关行标识',
                        align:'center',
                        editor: {
                            type: 'checkbox',
                            options: {
                                on: 'true',
                                off: 'false'
                            }
                        },
                        formatter: function (value, rowData, rowIndex) {
                            if (value != null && value.toString() == 'true') {
                                return '<input type="checkbox" disabled="true" checked="checked" />';
                            } else {
                                return '<input type="checkbox" disabled="true" />';
                            }
                        }
                    },
                    {field: 'ship_corp_flag',
                        title: '船公司标识',
                        align:'center',
                        editor: {
                            type: 'checkbox',
                            options: {
                                on: 'true',
                                off: 'false'
                            }
                        },
                        formatter: function (value, rowData, rowIndex) {
                            if (value != null && value.toString() == 'true') {
                                return '<input type="checkbox" disabled="true" checked="checked" />';
                            } else {
                                return '<input type="checkbox" disabled="true" />';
                            }
                        }
                    },
                    {field: 'yard_flag',
                        title: '场站标识',
                        align:'center',
                        editor: {
                            type: 'checkbox',
                            options: {
                                on: 'true',
                                off: 'false'
                            }
                        },
                        formatter: function (value, rowData, rowIndex) {
                            if (value != null && value.toString() == 'true') {
                                return '<input type="checkbox" disabled="true" checked="checked" />';
                            } else {
                                return '<input type="checkbox" disabled="true" />';
                            }
                        }
                    },
                    {field: 'port_flag',
                        title: '码头标识',
                        align:'center',
                        editor: {
                            type: 'checkbox',
                            options: {
                                on: 'true',
                                off: 'false'
                            }
                        },
                        formatter: function (value, rowData, rowIndex) {
                            if (value != null && value.toString() == 'true') {
                                return '<input type="checkbox" disabled="true" checked="checked" />';
                            } else {
                                return '<input type="checkbox" disabled="true" />';
                            }
                        }
                    },
                    {field: 'financial_flag',
                        title: '财务往来单位标识',
                        align:'center',
                        editor: {
                            type: 'checkbox',
                            options: {
                                on: 'true',
                                off: 'false'
                            }
                        },
                        formatter: function (value, rowData, rowIndex) {
                            if (value != null && value.toString() == 'true') {
                                return '<input type="checkbox" disabled="true" checked="checked" />';
                            } else {
                                return '<input type="checkbox" disabled="true" />';
                            }
                        }
                    },
                    {
                        field: 'remark',
                        title: '备注',
                        width: 400
                    }
                ]
            ],
            fit: true,
            idField: 'id',
            method: 'post',
            pageList: [10, 20, 30, 40],
            pageSize: 10,
            pagination: true,
            rownumbers: true,
            singleSelect: true,
            toolbar: [
                {text: '增加',
                    iconCls: 'icon-add',
                    handler: function () {
                        basedata.clientsview.datagrid.datagrid('insertData', {
                            insert_flag: true,
                            client_name: '新客户名称'
                        });
                    }},
                {text: '保存',
                    iconCls: 'icon-save',
                    handler: function () {
                        if (basedata.clientsview.datagrid.datagrid('preSave') == 1) {
                            var deleteArray = new Array();
                            var deletedRows = basedata.clientsview.datagrid.datagrid('getChanges', 'deleted');
                            for (var i = 0; i < deletedRows.length; i++) {
                                deleteArray.push(deletedRows[i].id);
                            }
                            var p = {
                                i: basedata.clientsview.datagrid.datagrid('getChanges', 'inserted'),
                                d: deleteArray,
                                u: basedata.clientsview.datagrid.datagrid('getChanges', 'updated'),
                            };
                            $.ajax({
                                url: '',
                                type: 'POST',
                                data: JSON.stringify(p),
                                contentType: 'application/json',
                                dataType: 'json',
                                success: function (r, t, a) {
                                    $.ajaxSettings.success(r, t, a);
                                    if (r && r.status == 32) {
                                        basedata.clientsview.datagrid.datagrid('afterSave');
                                    }
                                }
                            });
                        } else {
                            console.info('失败');
                        }
                    }}
            ],
            url: "{% url 'getclients' %}",
            onDblClickRow: function (rowIndex, rowData) {
                basedata.clientsview.datagrid.datagrid('dbClick', rowIndex);
            },
            onClickRow: function (rowIndex, rowData) {
                basedata.clientsview.datagrid.datagrid('click',rowIndex);
            }
        });
    });
</script>
{% csrf_token %}
<div class="easyui-layout" data-options="fit:true,border:false">
    <div region="center" border="false">
        <table id="basedata-client-datagrid" border="false">
        </table>
    </div>
</div>